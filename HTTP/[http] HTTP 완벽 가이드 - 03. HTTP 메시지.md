# HTTP 완벽 가이드

## 3장. HTTP 메시지

### 3.1 메시지의 흐름

- HTTP 메시지는 HTTP 애플리케이션 간에 주고받은 데이터의 블록들

#### 3.1.1 메시지는 원 서버 방향을 인바운드로 하여 송신된다

- HTTP는 인바운드와 아웃바운드라는 용어를 트랜잭션 방향을 표현하기 위해 사용함
- 메시지가 원 서버로 향하는 것 : 인바운드
- 모든 처리가 끝나고 메시지가 사용자 에이전트로 돌아오는 것 : 아웃바운드

#### 3.1.2 다운스트림으로 흐르는 메시지

- 모든 메시지는 다운스트림으로 흐름
- 메시지 발송자는 수신자의 업스트림임

### 3.2 메시지의 각 부분

- 메시지는 시작줄, 헤더 블록, 본문으로 구성됨
  - 시작줄 : 이것이 어떤 메시지인지 서술함
  - 헤더 블록 : 속성
  - 본문 : 데이터(없을 수도 있음)
- 시작줄과 헤더는 줄 단위로 분리된 아스키 문자열임
  - 각 줄은 캐리지 리턴(ASCII 13)과 개행 문자(ASCII 10)로 구성된 두 글자의 줄바꿈 문자열로 끝남
  - 이 줄바꿈 문자열 : `CRLF`
  - 견고한 애플리케이션은 `CRLF` 뿐만 아니라 그냥 개행 문자도 받아들일 수 있어야함

#### 3.2.1 메시지 문법

- 모든 HTTP 메시지는 요청 메시지 혹은 응답 메시지

- 요청 메시지 : 웹 서버에 어떤 동작을 요구

- 응답 메시지 : 요청의 결과를 클라이언트에게 돌려줌

- 요청 메시지의 형식

  - <메서드> <요청 URL> <버전>

    <헤더>



    <엔티티 본문>

- 응답 메시지의 형식

  - <버전> <상태 코드> <사유 구절>

    <헤더>



    <엔티티 본문>

- **메서드**

  - 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작(ex. `GET`, `HEAD`, `POST`)
- **요청 URL**
  - 요청 대상이 되는 리소스를 지칭하는 완전한 URL 혹은 URL 경로 구성요소
- **버전**

  - 이 메시지에서 사용 중인 HTTP의 버전
  - 형식 : `HTTP/<메이저>.<마이너>`
- **상태 코드**

  - 요청 중에 무엇이 일어났는지 설명하는 세 자리 숫자
- **사유 구절(reason-phrase)**
  - 상태 코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구
  - 상태 코드 이후부터 줄바꿈 문자열까지가 사유 구절
  - 오로지 사람에게 읽히기 위한 목적으로만 존재
- **헤더들**
- **엔터티 본문**
  - 임의의 데이터 블록을 포함함

#### 3.2.2 시작줄

- 모든 HTTP 메시지는 시작줄로 시작함

- **요청줄**

  - 요청 메시지는 서버에게 리소스에 대해 무언가를 해달라고 부탁함
  - 시작줄 혹은 요청 줄에 메서드와 요청 URL, HTTP 버전이 있음
  - 모든 필드는 공백으로 구분
    - `GET /test/hi-there.txt HTTP/1.1`

- **응답줄**

  - 응답 메시지는 수행 결과에 대한 상태 정보와 결과 데이터를 클라이언트에게 돌려줌
  - 시작줄 혹은 응답줄에는 HTTP의 버전, 상태 코드, 사유 구절이 있음
  - 모든 필드는 공백으로 구분
    - `HTTP/1.0 200 OK`

- **메서드**

  - HTTP 명세는 공통 요청 메서드의 집합을 정의함

  - GET : 서버에서 어떤 문서를 가져옴, 메시지 본문 없음

    HEAD : 서버에서 어떤 문서에 대해 헤더만 가져옴, 메시지 본문 없음

    POST : 서버가 처리해야 할 데이터를 보냄, 메시지 본문 있음

    PUT : 서버에 요청 메시지의 본문을 저장함, 메시지 본문 있음

    TRACE : 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적함, 메시지 본문 없음

    OPTIONS : 서버가 어떤 메서드를 수행할 수 있는지 확인함, 메시지 본문 없음

    DELETE : 서버에서 문서를 제거함, 메시지 본문 없음

  - 다른 서버는 메서드를 추가로 구현했을 수도 있음 : 이러한 추가 메서드는 HTTP 명세를 확장하는 것이므로 확장 메서드라고 불림

- **상태 코드**

  - 상태 코드는 클라이언트에게 무엇이 일어났는지 말해줌
  - 응답의 시작줄에 위치함
  - 사유 구절은 사람이 쉽게 읽을 수 있고, 숫자로 된 코드는 프로그램이 에러를 처리하기 쉬움

- 사유 구절

  - 사유 구절은 응답 시작줄의 마지막 구성요소임
  - 사유 구절은 상태 코드오 ㅏ일대일로 대응됨

- 버전 번호

  - `HTTP/x.y` 형식
  - 요청과 응답 메시지 양쪽에 모두 기술됨
  - 버전 번호는 HTTP로 대화하는 애플리케이션들에게 대화 상태의 능력과 메시지의 형식에 대한 단서를 제공해주기 위한 것임
  - 응답의 프로토콜 버전이 HTTP/1.1 이라는 것은 응답을 보낸 애플리케이션이 HTTP/1.1까지 이해할 수 있음을 의미함
  - 버전 번호는 분수로 다루어지지 않음
    - 버전의 각 숫자(ex. `HTTP/1.0`의 `1`과 `0`)는 각각 분리된 숫자로 다루어짐
    - `HTTP/2.22`는 `HTTP/2.3`보다 큼(22는 3보다 크기 때문)

#### 3.2.3 헤더

- 시작줄 다음에는 HTTP 헤더가 옴
- HTTP 헤더 필드는 기본적으로 이름/값 쌍의 목록임

- **헤더 분류**

  - 일반 헤더 : 요청과 응답 양쪽에 모두 나타날 수 있음
  - 요청 헤더 : 요청에 대한 부가 정보 제공
  - 응답 헤더 : 응답에 대한 부가 정보 제공
  - Entity 헤더 : 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술
  - 확장 헤더 : 명세에 정의되지 않은 새로운 헤더

- **헤더를 여러 줄로 나누기**

  - 헤더 줄은 여러 줄로 쪼갤 수 있는데, 추가 줄 앞에는 최소 하나의 스페이스 혹은 탭 문자가 와야 함

    ```
    HTTP/1.0 200 OK
    Content-Type: image/gif
    Content-Length: 8572
    Server: Test Server
    	Version 1.0
    ```

    응답 메시지는 여러 줄의 Server 헤더를 포함함

    헤더의 완전한 값은 `Test Server Version 1.0` 임

#### 3.2.4 엔터티 본문

- HTTP 메시지의 세 번째 부분은 선택적인 엔터티 본문
- HTTP 메시지는 여러 종류의 디지털 데이터를 전달할 수 있음

#### 3.2.5 버전 0.9 메시지

- HTTP 버전 0.9는 HTTP 프로토콜의 초기 버전

### 3.3 메서드

- 모든 서버가 모든 메서드를 구현하지는 않음

#### 3.3.1 안전한 메서드(Safe Method)

- HTTP는 안전한 메서드라 불리는 메서드의 집합을 정의함
- GET과 HEAD 메서드는 안전한데, 이 메서드를 사용하는 HTTP 요청의 결과로 서버에 어떤 작용도 없음
- 하지만 안전한 메서드가 서버에 작용을 유발하지 않는다는 보장은 없음
- 안전한 메서드의 목적은 서버에 어떤 영향을 줄 수 있는 안전하지 않은 메서드가 사용될 때 사용자에게 그 사실을 알려주는 HTTP 애플리케이션을 만들 수 있도록 하는 것

#### 3.3.2 GET

- 서버에 리소스를 요청하기 위해 쓰임

#### 3.3.3 HEAD

- HEAD 메서드는 GET처럼 행동하지만, 서버는 응답으로 헤더만을 돌려주며 엔터티 본문은 반환되지 않음
- HAED를 사용하면
  - 리소스를 가져오지 않고도 그에 대한 무엇을 알 수 있음
  - 응답의 상태 코드를 통해, 개체가 존재하는지 확인할 수 있음
  - 헤더를 확인하여 리소스가 변경되었는지 검사할 수 있음
- 서버 개발자는 반드시 반환되는 헤더가 GET으로 얻는 것과 정확히 일치함을 보장해야 함
- HTTP/1.1 준수를 위해서는 HEAD 메서드가 반드시 구현되어 있어야 함

#### 3.3.4 PUT

- PUT 메서드는 서버에 문서를 씀
- PUT 메서드의 의미는, 서버가 요청의 본문을 가지고 요청의 URL의 이름대로 새 문서를 만들거나, 이미 URL이 존재한다면 본문을 사용해서 교체하는 것임

#### 3.3.5 POST

- POST 메서드는 서버에 입력 데이터를 전송하기 위해 설계됨
- HTML 폼을 지원하기 위해 주로 사용됨
- 폼에 담긴 데이터는 서버로 전송되고, 서버는 이를 모아 필요로 하는 곳(ex. 데이터를 처리할 서버 게이트웨이 프로그램)에 보냄

#### 3.3.6 TRACE

- TRACE 메서드는 클라이언트에게 자신의 요청이 서버에 도달했을 때 어떻게 보이게 되는지 알려줌
- TRACE 요청은 목적지 서버에서 `루프백(loopback)` 진단을 시작함
  - 요청 전송의 마지막 단계에 있는 서버는 자신이 받은 요청 메시지를 본문에 넣어 TRACE 응답을 되돌려줌
  - 클라이언트는 자신과 목적지 서버 사이에 있는 모든 HTTP 애플리케이션의 요청/응답 연쇄를 따라가면서 자신이 보낸 메시지를 확인할 수 있음
- TRACE 메서드는 주로 진단을 위해 사용됨
- TRACE 요청은 엔터티 본문을 보낼 수 없음
  - TRACE 응답의 엔터티 본문에는 서버가 받은 요청이 있기 때문

#### 3.3.7 OPTIONS

- OPTIONS 메서드는 웹 서버에게 여러 가지 종류의 지원 범위에 대해 물어봄
- 서버에게 특정 리소스에 대해 어떤 메서드가 지원되는지 물어볼 수 있음

#### 3.3.8 DELETE

- DELETE 메서드는 서버에게 요청 URL로 지정한 리소스를 삭제할 것을 요청함

#### 3.3.9 확장 메서드

- 확장 메서드는 HTTP/1.1 명세에 정의되지 않은 메서드
- 개발자는 서버가 관리하는 리소스에 대한 능력을 확장할 수 있음
- 이해할 수 없는 확장 메서드를 사용하는 애플리케이션이 있으면 확장 메서드에 대해 관용적인 것이 최고
- 확장 메서드를 다룰 때는 `엄격하게 보내고 관대하게 받아들여라`는 규칙을 따르는 것이 가장 좋음

### 3.4. 상태 코드

- 상태 코드는 클라이언트에게 그들의 트랜잭션을 이해할 수 있는 쉬운 방법을 제공함

#### 3.4.1 100-199: 정보성 상태 코드

- 정보성 상태 코드는 HTTP/1.1에서 도입됨
- **클라이언트와 100 Continue**
- **서버와 100 Continue**
- **프락시와 100 Continue**

#### 3.4.2 200-299: 성공 상태 코드

#### 3.4.3 300-399: 리다이렉션 상태 코드

- HEAD가 아닌 요청에 대해 리다이렉션 상태 코드를 포함한 응답을 할 때, 리다이렉트될 URL에 대한 링크와 설명을 포함시키는 것이 좋음

- 서버는 리다이렉트 응답에 들어갈 가장 적절한 리다이렉트 상태 코드를 선택하기 위해 클라이언트의 HTTP 버전을 검사할 필요가 있음

#### 3.4.4 400-499: 클라이언트 에러 상태 코드

#### 3.4.5 500-599: 서버 에러 상태 코드

### 3.5 헤더

- 헤더와 메서드는 클라이언트와 서버가 무엇을 하는지 결정하기 위해 함께 사용됨
- 일반 헤더(General Headers)
  - 일반 헤더는 클라이언트와 서버 양쪽 모두가 사용함
- 요청 헤더(Request Headers)
  - 요청 메시지를 위한 헤더
  - 서버에게 클라이언트가 받고자 하는 데이터의 타입이 무엇인지와 같은 부가 정보를 제공함
- 응답 헤더(Response Headers)
  - 응답 메시지는 클라이언트에게 정보를 제공하기 위한 자신만의 헤더를 갖고 있음
- 엔터티 헤더(Entity Headers)
  - 엔터티 본문에 대한 헤더
- 확장 헤더(Extension Headers)
  - 확장 헤더는 애플리케이션 개발자들에 의해 만들어졌지만 아직 승인된 HTTP 명세에는 추가되지 않은 비표준 헤더

#### 3.5.1 일반 헤더

- 메시지에 대한 아주 기본적인 정보를 제공함
- 일반 캐시 헤더
  - HTTP/1.0은 HTTP 애플리케이션에게 매번 원 서버로부터 객체를 가져오는 대신 로컬 복사본으로 캐시할 수 있도록 해주는 최초의 헤더를 도입함

#### 3.5.2 요청 헤더

- 요청 메시지에서만 의미를 갖는 헤더
- 서버는 요청 헤더가 준 클라이언트에 대한 그 정보를 활용할 수 있음

- Accept 관련 헤더
  - 클라이언트는 Acceipt 관련 헤더를 이용해 서버에게 자신의 선호와 능력을 알려줄 수 있음
- 조건부 요청 헤더
  - 조건부 요청 헤더를 사용하면, 클라이언트는 서버에게 요청에 응답하기 전에 먼저 조건이 참인지 확인하게 하는 제약을 포함시킬 수 있음
- 요청 보안 헤더
  - HTTP는 자체적으로 요청을 위한 간단한 인증요구/응답 체계를 가지고 있음
- 프락시 요청 헤더
  - 인터넷에서 프락시가 흔해지면서, 그 기능을 돕기 위해 몇몇 헤더들이 정의되어 왔음

#### 3.5.3 응답 헤더

- 응답 메시지는 응답 헤더를 가짐
- 클라이언트에게 부가 정보를 제공함
- 종류
  - 협상 헤더
  - 응답 보안 헤더

#### 3.5.4 엔터티 헤더

- 요청과 응답 모두 사용 가능
- 종류
  - 콘텐츠 헤더
  - 엔터티 캐싱 헤더

