# HTTP 완벽 가이드

## 12장. 기본 인증

### 12.1 인증

#### 12.1.1 HTTP의 인증요구/응답 프레임워크

- 요청(Client → Server) → 인증요구(Server → Client) → 인가(Client → Server) → 성공Server → Client

#### 12.1.2 인증 프로토콜과 헤더

- 인증 프로토콜은 HTTP 인증 헤더에 기술되어 있음
- HTTP에는 기본 인증과 다이제스트 인증이라는 두 가지 공식적인 인증 프로토콜이 있음
- 기본인증
  - 서버가 사용자에게 인증요구를 보낼 때, 서버는 401 Unauthorized 응답과 함께 WWW-Authenticate 헤더를 기술해서 어디서 어떻게 인증할지 설명함
  - 클라이언트가 서버로 인증하려면, 인코딩된 비밀번호와 그 외 인증 파라미터들을 Authorization 헤더에 담아서 요청을 다시 보냄
  - 인증 요쳥이 성공적으로 완료되면, 서버는 정상적인 상태 코드(ex. 200 OK)를 반환하며, 추가적인 인증 알고리즘에 대한 정보를 Authentication-Info 헤더에 기술할 수도 있음

#### 12.1.3 보안 영역

- HTTP가 어떻게 각 리소스마다 다른 접근 조건을 다루는지

  - 서버가 클라이언트로 인증요구를 할 때, realm 지시자가 기술되어 있는 WWW-Authenticate 헤더가 있음

  - 웹 서버는 기밀문서를 보안 영역(realm) 그룹으로 나눔

  - 보안 영역은 저마다 다른 사용자 권한을 요구함

  - 예

    ```http
    HTTP/1.0 401 Unauthorized
    WWW-Authenticate: Basic realm="Corporate Financials"
    ```

### 12.2 기본 인증

- 기본 인증은 가장 잘 알려진 HTTP 인증 규약임

- 기본 인증에서, 웹 서버는 200대신 401 상태 코드와 함께, 클라이언트가 접근하려고 했던 보안 영역을 WWW-Authenticate에 기술해서 응답하여 인증요구를 시작함

  브라우저는 사용자가 계정과 비밀번호를 입력할 수 있는 대화상자를 염

  사용자가 입력한 이름과 비밀번호를 Authorization 요청 헤더 안에 암호화해서 서버로 다시 보냄

#### 12.2.1 기본 인증의 예

- 기본 인증 헤더

  | 인증요구/응답                   | 헤더 문법과 설명                                             |
  | ------------------------------- | ------------------------------------------------------------ |
  | 인증요구(서버에서 클라이언트로) | `WWW-Authenticate: Basic realm=따옴표로 감싼 문서 집합 정보` |
  | 응답(클라이언트에서 서버로)     | `Authorization: Basic base-64로 인코딩한 사용자 이름과 비밀번호` |

#### 12.2.2 Base-64 사용자 이름/비밀번호 인코딩

- HTTP 기본 인증은 사용자 이름과 비밀번호를 콜론으로 이어서 합치고, base-64 인코딩 메서드를 사용해 인코딩 함

- base-64 인코딩은 8비트 바이트로 이루어져 있는 시퀀스를 6비트 덩어리의 시퀀스로 변환함

  각 6비트 조각은 대부분 문자와 숫자로 이루어진 특별한 64개의 문자 중에서 선택됨

- Base-64 인코딩은 바이너리, 텍스트, 국제 문자 데이터(어떤 시스템에서는 문제를 일으킬 수 있는) 문자열을 받아서 전송할 수 있게, 그 문자열을 전송 가능한 문자인 알파벳으로 변환하기 위해 발명되었음

#### 12.2.3 프락시 인증

- 중개 프락시 서버를 통해 인증할 수도 있음

- 프락시 서버에서 접근 정책을 중앙 관리할 수 있기 때문에, 회사 리소스 전체에 대한 통합적인 접근을 제어하기 위해서 사용하면 좋음

- 프락시 인증은 웹 서버의 인증과 헤더와 상태 코드만 다르고 절차는 같음

  | 웹 서버                | 프락시 서버               |
  | ---------------------- | ------------------------- |
  | 비인증 상태 코드 : 401 | 비인증 상태 코드 : 407    |
  | WWW-Authenticate       | Proxy-Authenticate        |
  | Authorization          | Proxy-Authorization       |
  | Authentication-Info    | Proxy-Authentication-Info |

### 12.3 기본 인증의 보안 결함

- 보안 결함

  1. base-64로 인코딩된 비밀번호는 사실상 '그대로' 보내는 것과 다름없음

     그러므로 모든 HTTP 트랜잭션을 SSL 암호화 채널을 통해 보내거나, 보안이 더 강화된 다이제스트 인증 같은 프로토콜을 사용하는 것이 좋음

  2. 기본 인증은 재전송 공격을 예방하기 위한 어떠한 일도 하지 않음

  3. 가벼운 사이트에서 사용자 이름과 비밀번호 문자열을 캡처하여 동일한 정보로 중요한 온라인 은행 사이트에 접근할 수도 있음

  4. 프락시나 중개자가 중간에 개입하는 경우, 기본 인증은 정상적인 동작을 보장하지 않음

  5. 가짜 서버의 위장에 취약함

- 기본 인증은 일반적인 환경에서 개인화나 접근을 제어하는데 편리하며, 다른 사람들이 보지 않기를 원하지만, 보더라도 치명적이지 않은 경우에는 여전히 유용함

- 기본 인증은 사용자 이름과 비밀번호를 악의적인 개인들에게 숨기려고 암호화된 데이터 전송(SSL 같은)과 연계해서 사용할 수 있음

