# YOU DON'T KNOW JS 타입과 문법, 스코프와 클로저

## CHAPTER 5. 문법

### 5.1 문과 표현식

- 문(Statement)과 표현식(Expression)

- 자바스크립트에서

  - 문(Statement)은 문장(Sentence), 표현식(Expression)은 어구(Phrase), 연산자는 구두점/접속사에 해당됨

  - 모든 표현식은 단일한, 특정한 결괏값으로 계산됨

  - 예

    ```javascript
    var a = 3 * 6;
    var b = a;
    b;
    ```

    - 세 줄은 각각 표현식이 포함된 문임
    - 첫째, 둘째 문장은 각각 변수를 선어(그리고 선택적으로 동시에 어떤 값을 할당)하므로 '선언문(Declaration Statement)'이라 함
    - (앞에 var가 빠진) `a = 3 * 6`나 `b = a`는 '할당 표현식(Assignment Expression)'이라고 함
    - 세 번째 줄은 b가 표현식의 전부이지만 이것만으로도 완전한 문임, '표현식 문(Expression Statement)'이라고 일컬음

#### 5.1.1 문의 완료 값

- 모든 문은 (그 값이 undefined라 해도) 완료 값(Completion Value)을 가짐

- 브라우저 개발자 콘솔 창에서 문을 타이핑하면 가장 최근에 실행된 문의 완료 값이 기본적으로 출력됨

- 할당 표현식 `b = a`는 할당 이후의 값이 완료 값이지만, `var` 문 자체의 완료 값은 `undefined`임

- 다른 종류의 문 완료 값

  - 보통의 `{ }` 블록은 내부의 가장 마지막 문/표현식의 완료 값을 자신의 완료 값으로 반환함

    ```javascript
    var b;
    
    if (true) {
        b = 4 + 38;
    }
    ```

    콘솔 창에서 실행하면 42가 나옴

    블록의 완료 값은 내부에 있는 마지막 문의 값을 암시적으로 반환한 값임

  - 다음 코드는 작동하지 않음

    ```javascript
    var a, b;
    a = if (true) {
        b = 4 + 38;
    };
    ```

    완료 값을 포착하기 위해 어쩔 수 없이 eval() 함수를 사용함

    ```javascript
    var a, b;
    a = eval( "if (true) { b = 4 + 38; }" );
    a; // 42
    ```

    ES7 명세에는 'do 표현식'이 제안됨

    ```javascript
    var a, b;
    a = do {
        if (true) {
            b = 4 + 38;
        }  
    };
    a; // 42
    ```

    - `do { }` 표현식은 (하나 이상의 문을 포함한) 블록 실행 후 블록 내 마지막 문의 완료 값을 do 표현식 전체의 완료 값으로 반환하며 결국 이 값이 변수 a에 할당됨
    - 인라인 함수 표현식 안에 감싸서 명시적으로 반환할 필요 없이 문을 (다른 문 안에 들어갈 수 있는) 표현식처럼 다루자는 게 기본적인 아이디어임


#### 5.1.2 표현식의 부수 효과

- 대부분의 표현식에는 부수 효과가 없음

  ```javascript
  var a = 2;
  var b = a + 3;
  ```

- 함수 호출 표현식은 부수 효과를 가진(가졌을지 모를) 표현식의 예

  ```javascript
  function foo() {
      a = a + 1;
  }
  
  var a = 1;
  foo(); // 결과값: 'undefined', 부수 효과: 'a'가 변경됨
  ```

- 다른 부수 효과를 지닌 표현식

  ```javascript
  var a = 42;
  var b = a++;
  ```

  - 표현식 `a++`이 하는 일은 두 가지임
    1. a의 현재 값 42를 반환(그리고 b에 할당하는 것까지)하고
    2. a 값을 1만큼 증가시킴
  - `++`를 전위 연산자로 사용하면 표현식으로부터 값이 반환되기 전에 (a 값을 1만큼 증가시키는) 부수 효과를 일으킴
  - 후위 연산자로 사용하면 값을 반환한 이후에 부수 효과가 발생함

  > `++a++`은 실행하면 ReferenceError가 남
  >
  > - 부수 효과를 유발하는 연산자는 부수 효과를 일으킬 변수 레퍼런스가 꼭 필요하기 때문임
  >
  > - `++a++`에서는 `a++` 부분이 먼저 평가되어 증가되기 이전의 값을 돌려줌
  >
  >   따라서 `++42` 평가시 `++` 연산자는 42 같은 원시 값에 직접 부수 효과를 일으킬 수는 없으므로 ReferenceError를 던짐

- `a++`를 `()`로 감싸면 후위 부수 효과를 캡슐화할 수 있다고 착각하는 경우도 있음

  ```javascript
  var a = 42;
  var b = (a++);
  
  a; // 43
  b; // 42
  ```

  - `()` 로 둘러싼다 해도 `a++` 표현식에서 부수 효과 발생 이후 재평가된 새 표현식을 만들어내는 건 불가능함

  - 하지만 콤마 연산자 `,`를 사용하면 다수의 개별 표현식을 하나의 문으로 연결할 수 있음

    ```javascript
    var a = 42, b;
    b = ( a++, a );
    
    a; // 43
    b; // 43
    ```

    